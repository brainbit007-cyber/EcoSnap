<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSnap 3D – Save Earth in Real 3D</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;900&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Poppins', sans-serif;
            color: white;
            height: 100vh;
            perspective: 2000px;
            cursor: none;
        }
        #cursor {
            position: fixed;
            width: 40px; height: 40px;
            background: radial-gradient(circle, #00ff88, #00ff8800);
            border: 2px solid #00ff88;
            border-radius: 50%;
            pointer-events: none;
            z-index: 999999;
            box-shadow: 0 0 60px #00ff88;
            transition: all 0.1s;
            transform: translate(-50%, -50%);
        }
        #progress {
            position: fixed;
            top: 0; left: 0; width: 0%; height: 8px;
            background: linear-gradient(90deg, #00ff88, #00ffff);
            z-index: 99999;
            box-shadow: 0 0 30px #00ff88;
        }
        .scene { 
            position: fixed;
            width: 100vw; height: 100vh;
            transform-style: preserve-3d;
        }
        .layer {
            position: absolute;
            width: 100%; height: 100%;
            background-size: cover;
            transform-style: preserve-3d;
        }
        #globe-container {
            position: fixed;
            top: 50%; left: 50%;
            width: 600px; height: 600px;
            transform: translate(-50%, -50%) translateZ(200px);
            z-index: 10;
        }
        canvas { display: block; }
        .ui {
            position: fixed;
            z-index: 100;
            padding: 20px;
            pointer-events: none;
        }
        .top { top: 20px; left: 20px; }
        .bottom { bottom: 20px; right: 20px; text-align: right; }
        h1 {
            font-family: 'Orbitron', monospace;
            font-size: 5vw;
            background: linear-gradient(45deg, #00ff88, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 50px rgba(0,255,136,0.8);
            animation: glow 3s infinite alternate;
        }
        @keyframes glow { from { filter: hue-rotate(0deg); } to { filter: hue-rotate(360deg); } }
    </style>
    <!-- THREE.js + WebGL Globe -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
    <div id="cursor"></div>
    <div id="progress"></div>
    
    <div class="scene">
        <div class="layer" style="background: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2784') center/cover; transform: translateZ(-500px) scale(2); filter: brightness(0.3);"></div>
        <div class="layer" style="background: radial-gradient(circle at center, #0000, #000); transform: translateZ(-200px);"></div>
        
        <div id="globe-container"></div>
        
        <div class="ui top">
            <h1>ECOSNAP 3D</h1>
            <p style="font-size:2vw; margin-top:20px; opacity:0.9;">
                DRAG THE GLOBE • CLICK COUNTRIES • MOVE MOUSE FOR 3D SOUND
            </p>
        </div>
        
        <div class="ui bottom">
            <p style="font-size:1.5vw;">Pledges today: <span id="pledgeCount">0</span></p>
            <button onclick="makePledge()" style="padding:15px 40px; background:#00ff88; border:none; border-radius:50px; font-weight:900; font-size:1.5vw; cursor:pointer; pointer-events:auto;">
                I PLEDGE TO SAVE EARTH
            </button>
        </div>
    </div>

    <!-- 3D SPATIAL AUDIO THAT FOLLOWS MOUSE -->
    <audio id="ambient" loop autoplay>
        <source src="https://cdn.pixabay.com/download/audio/2023/08/15/audio_7e6d7e9f2e.mp3?filename=ambient-space-124462.mp3" type="audio/mp3">
    </audio>

    <script>
        // ===== 3D GLOBE WITH THREE.JS =====
        let camera, scene, renderer, globe, controls;
        let mouseX = 0, mouseY = 0;
        const pledges = [];

        function initGlobe() {
            const container = document.getElementById('globe-container');
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
            camera.position.z = 500;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(600, 600);
            container.appendChild(renderer.domElement);

            // EARTH
            const geometry = new THREE.SphereGeometry(200, 64, 64);
            const texture = new THREE.TextureLoader().load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg');
            const material = new THREE.MeshPhongMaterial({ map: texture, bumpScale: 0.05 });
            globe = new THREE.Mesh(geometry, material);
            scene.add(globe);

            // ATMOSPHERE
            const atmosphere = new THREE.Mesh(
                new THREE.SphereGeometry(205, 64, 64),
                new THREE.MeshBasicMaterial({
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.1
                })
            );
            scene.add(atmosphere);

            // LIGHTS
            const light = new THREE.DirectionalLight(0xffffff, 1.5);
            light.position.set(500, 500, 500);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            // CONTROLS
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.5;

            // CLICK COUNTRY
            renderer.domElement.addEventListener('click', onGlobeClick);

            animate();
        }

        function onGlobeClick(event) {
            const rect = renderer.domElement.getBoundingClientRect();
            mouseX = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouseY = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            const vector = new THREE.Vector3(mouseX, mouseY, 0.5);
            vector.unproject(camera);
            const ray = new THREE.Raycaster(camera.position, vector.sub(camera.position).normalize());
            const intersects = ray.intersectObject(globe);

            if (intersects.length > 0) {
                const point = intersects[0].point;
                createFirework(point);
                showCountryInfo(point);
            }
        }

        function createFirework(position) {
            for(let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.width = '8px';
                particle.style.height = '8px';
                particle.style.borderRadius = '50%';
                particle.style.background = ['#00ff88','#00ffff','#ff00ff','#ffff00'][i%4];
                particle.style.left = (window.innerWidth/2 + position.x * 2) + 'px';
                particle.style.top = (window.innerHeight/2 - position.y * 2) + 'px';
                particle.style.pointerEvents = 'none';
                particle.style.boxShadow = '0 0 20px currentColor';
                document.body.appendChild(particle);

                const angle = Math.random() * Math.PI * 2;
                const velocity = 5 + Math.random() * 10;
                const anim = particle.animate([
                    { transform: 'translate(0,0) scale(1)', opacity: 1 },
                    { transform: `translate(${Math.cos(angle)*velocity*100}px, ${Math.sin(angle)*velocity*100}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 1500,
                    easing: 'cubic-bezier(0.1, 0.7, 0.3, 1)'
                });
                anim.onfinish = () => particle.remove();
            }
        }

        function showCountryInfo(point) {
            const countries = ['Brazil','Norway','India','Australia','USA','China'];
            const facts = [
                'Amazon lost 17% since 1970',
                '98% renewable energy!',
                'Planted 50B trees',
                'Great Barrier Reef dying',
                'California wildfires up 400%',
                'Building 2 coal plants/week'
            ];
            const random = Math.floor(Math.random() * countries.length);
            alert(`${countries[random]}\n${facts[random]}`);
        }

        function animate() {
            requestAnimationFrame(animate);
            globe.rotation.y += 0.003;
            controls.update();
            renderer.render(scene, camera);
        }

        // ===== 3D SPATIAL SOUND FOLLOWING MOUSE =====
        const audio = document.getElementById('ambient');
        audio.volume = 0.6;
        
        document.addEventListener('mousemove', e => {
            // Cursor
            document.getElementById('cursor').style.left = e.clientX + 'px';
            document.getElementById('cursor').style.top = e.clientY + 'px';

            // 3D Audio Panning (Web Audio API)
            if (window.AudioContext) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!window.audioCtx) {
                    window.audioCtx = new AudioContext();
                    const track = window.audioCtx.createMediaElementSource(audio);
                    const panner = new PannerNode(window.audioCtx, {
                        panningModel: 'HRTF',
                        distanceModel: 'inverse',
                        refDistance: 1,
                        maxDistance: 10000,
                        rolloffFactor: 10
                    });
                    track.connect(panner).connect(window.audioCtx.destination);
                    window.panner = panner;
                }
                
                const x = (e.clientX / window.innerWidth) * 2 - 1;
                const y = (e.clientY / window.innerHeight) * 2 - 1;
                window.panner.positionX.setValueAtTime(x * 50, window.audioCtx.currentTime);
                window.panner.positionY.setValueAtTime(-y * 50, window.audioCtx.currentTime);
                window.panner.positionZ.setValueAtTime(0, window.audioCtx.currentTime);
            }
        });

        // ===== PLEDGE SYSTEM WITH 3D CARDS =====
        function makePledge() {
            const name = prompt("Your name, Earth hero?");
            if (!name) return;
            
            const card = document.createElement('div');
            card.style.position = 'fixed';
            card.style.padding = '20px 40px';
            card.style.background = 'linear-gradient(135deg, #00ff88, #00ffff)';
            card.style.borderRadius = '30px';
            card.style.fontWeight = '900';
            card.style.fontSize = '1.5vw';
            card.style.color = 'black';
            card.style.boxShadow = '0 0 50px #00ff88';
            card.style.transform = 'translateZ(500px)';
            card.style.left = Math.random() * 70 + 15 + 'vw';
            card.style.top = '-100px';
            card.innerHTML = name + ' PLEDGED!';
            document.body.appendChild(card);

            card.animate([
                { top: '-100px', transform: 'translateZ(500px) rotateX(90deg)' },
                { top: '50vh', transform: 'translateZ(0) rotateX(0deg)' }
            ], { duration: 2000, easing: 'cubic-bezier(0.2, 0.8, 0.4, 1)' });

            setTimeout(() => {
                card.style.transition = 'all 2s';
                card.style.transform = 'translateY(100vh) rotateZ(720deg)';
                card.style.opacity = '0';
                setTimeout(() => card.remove(), 2000);
            }, 3000);

            pledges.push(name);
            document.getElementById('pledgeCount').innerText = pledges.length;
        }

        // Progress
        window.addEventListener('scroll', () => {
            const h = document.documentElement;
            const percent = (window.scrollY / (h.scrollHeight - h.clientHeight)) * 100;
            document.getElementById('progress').style.width = percent + '%';
        });

        // Mobile gyro tilt
        window.addEventListener('deviceorientation', e => {
            if (e.beta !== null) {
                document.querySelector('.scene').style.transform = 
                    `rotateX(${e.beta}deg) rotateY(${e.gamma}deg)`;
            }
        });

        // INIT
        initGlobe();
        audio.play().catch(() => console.log("Audio autoplay blocked"));
    </script>
</body>
</html>
